# Code Smell: Comments 

**Code Smell** คือ สัญญาณบ่งบอกถึงปัญหาในโครงสร้างโค้ดที่อาจส่งผลต่อการบำรุงรักษาในระยะยาว ในหัวข้อนี้เราจะเจาะลึกไปที่ **"Comments"** (การใช้คอมเมนต์) ซึ่งเป็นหนึ่งใน Code Smell ที่พบบ่อยที่สุดและมักถูกมองข้าม

---

### a) ความหมายของ Code Smell: Comments
**Comment Smell** ไม่ใช่การบอกว่า "ห้ามเขียนคอมเมนต์" แต่หมายถึงเหตุการณ์ที่เรา **"ใช้คอมเมนต์เพื่อปกปิดโค้ดที่แย่"**

เมื่อโค้ดมีความซับซ้อน อ่านยาก หรือตั้งชื่อตัวแปรไม่สื่อความหมาย นักพัฒนามักจะเลือกเขียนคอมเมนต์ยาวๆ เพื่ออธิบายว่าโค้ดนั้นทำงานอย่างไร (How) หรือทำอะไร (What) แทนที่จะปรับปรุงตัวโค้ดให้ชัดเจนด้วยตัวเอง

> **กฎเหล็ก:** "อย่าเขียนคอมเมนต์เพื่อแก้ตัวให้กับโค้ดที่แย่ แต่จงเขียนโค้ดใหม่ให้ดีขึ้น" — *Martin Fowler*

---

### b) ตัวอย่างโค้ดที่เกิด Code Smell
ปัญหานี้มักเกิดเมื่อมีการใช้คอมเมนต์เพื่ออธิบาย Logic ที่ซับซ้อนเกินไป หรือใช้แทนการตั้งชื่อที่ดี:

```javascript
// 1. Redundant Comment: บอกสิ่งที่รู้อยู่แล้ว
// กำหนดค่าเริ่มต้นให้กับตัวแปร i เป็น 0
let i = 0;

// 2. Poor Naming: ใช้คอมเมนต์อธิบายตัวแปรชื่อย่อ
// d คือจำนวนวันที่เหลือสำหรับโปรโมชั่น
let d = 7;

// 3. Masking Bad Code: อธิบายยาวๆ เพราะ Logic ซับซ้อน
// ตรวจสอบว่า user มีสิทธิ์ login ไหม โดยเช็คว่ามีสถานะ active
// และไม่ได้ถูกแบน และอายุมากกว่า 18 ปี และยืนยันอีเมลแล้ว
if (user.status === 1 && user.banned === false && user.age >= 18 && user.emailVerified === true) {
  login();
}
```

---

### c) ตัวอย่างโค้ดที่ Refactoring แล้ว
เราสามารถแก้ไขได้ด้วยการใช้ **Self-Documenting Code** (โค้ดที่อธิบายตัวเอง) โดยการตั้งชื่อตัวแปรและฟังก์ชันให้สื่อความหมายชัดเจน จนคอมเมนต์เหล่านั้น "ไม่จำเป็น" อีกต่อไป:

```javascript
// 1. ลบคอมเมนต์ที่ซ้ำซ้อน
let i = 0;

// 2. Rename Variable: เปลี่ยนชื่อตัวแปรให้ชัดเจน
let remainingPromotionDays = 7;

// 3. Extract Function: แยกเงื่อนไขซับซ้อนออกมาเป็นฟังก์ชันที่มีชื่อสื่อความหมาย
function isEligibleForLogin(user) {
  const isActive = user.status === 1;
  const isNotBanned = !user.banned;
  const isAdult = user.age >= 18;
  
  return isActive && isNotBanned && isAdult && user.emailVerified;
}

if (isEligibleForLogin(user)) {
  login();
}
```

---

### d) กรณีที่ Code Smell นี้ไม่ได้บ่งบอกถึงโค้ดที่มีปัญหา (ไม่ต้อง Refactor)
ไม่ใช่ทุกคอมเมนต์จะเป็น Code Smell เสมอไป มีหลายสถานการณ์ที่คอมเมนต์มีความสำคัญและ **จำเป็นต้องมี** เพื่ออธิบายสิ่งที่โค้ดไม่สามารถบอกได้ (The "Why"):

1. **อธิบายเหตุผลทางธุรกิจ (Business Logic / Compliance):**
   ```javascript
   // ต้องหักภาษี 3% ตามกฎหมายมาตรา 40(7) สำหรับฟรีแลนซ์ในไทย
   const WH_TAX_RATE = 0.03;
   ```

2. **อธิบาย Workaround หรือข้อจำกัดทางเทคนิค:**
   ```javascript
   // จำเป็นต้องใช้ 'var' แทน 'let' ตรงนี้เพื่อให้ทำงานได้บน IE11 ของลูกค้าเก่า
   var legacyBrowserSupport = true;
   ```

3. **อธิบาย Algorithm ที่ซับซ้อนมาก:**
   ```javascript
   // ใช้สมการ Haversine Formula เพื่อคำนวณระยะทางระหว่างพิกัด GPS
   // อ้างอิงสูตร: https://en.wikipedia.org/wiki/Haversine_formula
   const R = 6371e3; // รัศมีโลก
   ```

4. **คำเตือน (Warning of Consequences):**
   ```javascript
   // WARNING: ห้ามเปลี่ยนลำดับฟังก์ชันนี้ เพราะต้องโหลด Config ก่อนเริ่ม Database
   initializeConfig();
   connectDatabase();
   ```

---

## สรุป
คอมเมนต์เป็นเหมือน "ดาบสองคม" หากใช้เพื่ออธิบาย **"ทำไม" (Why)** มันจะมีค่ามาก แต่หากใช้เพื่ออธิบาย **"ทำอะไร/อย่างไร" (What/How)** มันมักจะเป็นสัญญาณว่าโค้ดของคุณควรได้รับการปรับปรุง (Refactor) ครับ 
